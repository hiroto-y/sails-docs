# コントローラ

### 概要

コントローラ（**MVC**モデルでいうところの**C**）はSailsアプリケーションがWebブラウザやモバイルアプリケーションなどWebサーバと通信できる各種の端末から受けるリクエストを処理する基礎的なオブジェクトです。コントローラはしばしば[Model](http://sailsjs.org/documentation/concepts/ORM/Models.html)と[View](http://sailsjs.org/documentation/concepts/Views)の中間に立ちます。また、多くのケースではアプリケーションお大半の[ビジネスロジック](http://en.wikipedia.org/wiki/Business_logic)はコントローラの中に記述されます。

### アクション
コントローラは*アクション*と呼ばれるファンクションの集合から構成されます。アクションはあなたのアプリケーションのルーティングから転送されます。つまりクライアントが特定の[ルート](http://sailsjs.org/documentation/concepts/Routes)に対してリクエストを行った時にはアクションに転送されそこで何ら家のビジネスロジックを実行した上で（大抵の場合は）レスポンスを生成します。例えば「`/hello`のルートにGETアクセスがなされた場合以下の様なメソッドが呼び出す」ということが出来ます。:

```javascript
function (req, res) {
  return res.send("Hi there!");
}
```

このためブラウザが`/hello`のURLを呼び出した時はいつでも&ldquo;Hi there&rdquo;とメッセージが表示されるようになります。

### コントローラはどこで定義されますか
コントローラは`api/controllers`フォルダの中に定義されます。このフォルダにはどんなファイルでも置いていいですがSailsのコントローラとして読み込まれるためにはファイル名は必ず`Controller.js`で*終わらなければ*なりません。慣習に則り、Sailsのコントローラは[*パスカルケース*](http://c2.com/cgi/wiki?PascalCase)で命名されます。そのためすべての単語（最初の単語も含め）は大文字で始まらなければなりません。例えばUserController.js, MyController.js や`SomeGreatBigController.js` はすべて正しいフォーマットのパスカルケース命名です。

もしもコントローラをグループ分けする必要がある場合`api/controllers`の中にサブフォルダーを作成することが出来ます。ただし、サブフォルダー名はルーティングの過程で*コントローラの名前の一部*として取り扱われます。(詳細は下記の"Routing"セクションをご覧ください。)

### コントローラはどんなファイルですか
コントローラフォルダはアクション名をキーとしたJavascriptオブジェクトとして定義され、そのオブジェクトのキーの中身にアクションが入ります。以下にコントローラファイルの簡単な例を挙げます。:

```javascript
module.exports = {
  hi: function (req, res) {
    return res.send("Hi there!");
  },
  bye: function (req, res) {
    return res.redirect("http://www.sayonara.com");
  }
};
```

このコントローラには2つのアクションが定義されいます。アクション&ldquo;hi&rdquo;はテキストのレスポンスを返し、アクション&ldquo;bye&rdquo;は別のWebサイトへのリダイレクトを返します。`req`オブジェクトと`res`オブジェクトは[Express.js](https://github.com/expressjs)でWebアプリケーションを書いたことのある人は誰でも馴染みあるところです。これはSailsはルーティングにあたってExpressを裏方で利用しているという設計上の利用です。Expressのミドルウエアとは違いSailsのコントローラは常にリクエストチェーンの最後になります。つまり、常に何らかのレスポンスないしエラーを返さなければならないということです。アクションメソッドの中で別の方針を使うことは可能ですが、この方針をとって構わない時には[ポリシー](http://sailsjs.org/documentation/concepts/Policies)を利用することを強くおすすめします。




### 「軽量な」コントローラ

ほとんどのMVCフレームワークはコントローラを「軽量に」保つことを進めており、Sailsもその例外ではありませんが、（つまりSailsのコントローラ可能な限りシンプルにしておくべきです）ここで「なぜそうなのか」を知っておくのもいいでしょう。

コントローラのコートはトリガーやイベント本質的に独立しています。Sailsのようなバックエンドフレームワークでは、イベントは殆どの場合においてインカミングのリクエストです。そのためもしいくつかのコードを一つのコントローラアクションに書いてしまった場合リクエストのコンテキスト（つまり`req`オブジェクトと`res`オブジェクト）ごとに独立しているべきである各コードのスコープとは別のものになってしまいます。それは一時的には何とかなりますが、あとで「ちょっと違うアクション」やコマンドラインから呼び出したいときに困ったことになります。

そのため「軽量なコントローラ」の目指すものは再利用可能なコードが特定のスコープともつれ合ってしまっている状況を解消することです。Sailsにおいてこれを実現する方法はいろいろありますがコードをコントローラから独立させる最も一般的な方法は以下のとおりです。

+ 特定のモデルに対して特定のタスクを実行するためにカプセリングされたカスタムのモデルメソッドを書く。
+ 特定の用途に限定して使われるタスクを実行するためにカプセリングされたファンクションをサービスとして書く。
+ もし複数のアプリケーションを通じて有用であるコードを見つけた場合は（時間があれば）nodeのモジュールにしましょう。そうすればあなたの組織を通じて利用することが出来るようになりますし、更に良いこととしてはもしそれをnpmとしてオープンソースで公開すれば誰かが使ってくれたり、メンテナンスを手伝ってくれたりします。


<docmeta name="uniqueID" value="Controllers464694">
<docmeta name="displayName" value="Controllers">
